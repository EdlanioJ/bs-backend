// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  EMPLOYEE
  MANAGER
  USER
}

model User {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String
  avatar       String
  provider     String?
  role         Role     @default(USER)
  thirdPartyId String   @unique @map("third_party_id")
  refreshToken String?  @map("refresh_token")
  createdAt    DateTime @default(now()) @map("created_at")

  appointmentFrom Appointment[]    @relation("AppointmentFrom")
  appointmentTo   Appointment[]    @relation("AppointmentTo")
  serviceProvicer ServiceProvider? @relation("Provider")

  @@map("users")
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model Appointment {
  id             String            @id @default(auto()) @map("_id") @db.ObjectId
  start          DateTime          @map("start_time")
  end            DateTime          @map("end_time")
  status         AppointmentStatus @default(PENDING)
  canceled       DateTime?         @map("canceled_at")
  canceledReason String?           @map("canceled_reason")
  createdAt      DateTime          @default(now()) @map("created_at")

  employee   User   @relation("AppointmentTo", fields: [employeeId], references: [id])
  employeeId String @map("employee_id") @db.ObjectId
  customer   User   @relation("AppointmentFrom", fields: [customerId], references: [id])
  customerId String @map("custumer_id") @db.ObjectId

  service   Service @relation("Service", fields: [serviceId], references: [id])
  serviceId String  @map("service_id") @db.ObjectId

  @@map("appointments")
}

model ServiceProvider {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  name String

  user   User   @relation("Provider", fields: [userId], references: [id])
  userId String @unique @map("user_id") @db.ObjectId

  services Service[] @relation("ServiceProvider")
  @@map("services_provider")
}

model Service {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  name String

  appointmentDuration Int @default(60) @map("appointment_duration")

  provider   ServiceProvider @relation("ServiceProvider", fields: [providerId], references: [id])
  providerId String          @unique @map("provider_id") @db.ObjectId

  appointments Appointment[] @relation("Service")

  @@map("services")
}
